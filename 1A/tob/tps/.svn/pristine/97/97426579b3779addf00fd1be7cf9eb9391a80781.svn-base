package allumettes;

/** Un arbitre, comme son nom l'indique, arbitre la partie.
  * Il affiche le nombre d'allumettes restantes et vérifie
  * que les joueurs respectent les règles du jeu. Enfin, il
  * affiche le résultat en fin de partie.
  * @author Thomas SADURNI
  * @version 1.2
  */

public class Arbitre {

    /** Joueur 1 de la partie. */
    private Joueur joueur1;

    /** Joueur 2 de la partie. */
    private Joueur joueur2;

    /** Constucteur Arbitre. */
    public Arbitre(Joueur j1, Joueur j2) {
        assert(j1 != null);
        assert(j2 != null);
        this.joueur1=j1;
        this.joueur2=j2;
    }

    public void arbitrer(Jeu jeu) {
        assert(jeu != null);
        assert(jeu.getNombreAllumettes()>0);
        Joueur joueur_actuel = this.joueur1; //creation du joueur actuel
        boolean coup_fait = false;  //le coup a été réalisé.
        int nb = 0;
        while (jeu.getNombreAllumettes()>0){
            if(coup_fait){
              joueur_actuel=this.joueur2;
            }
            System.out.println("Nombre d'allumettes restantes : " + jeu.getNombreAllumettes());
            System.out.println("Au tour de " + joueur_actuel.getNom() + ".");
            
            try {
                nb = joueur_actuel.getPrise(jeu);
                jeu.retirer(nb);
                if (nb>2) {
                    System.out.println(joueur_actuel.getNom() + "a pris " + nb + " allumettes.");
                }
                else {
                    System.out.println(joueur_actuel.getNom() + "a pris " + nb + " allumette."); 
                }
                System.out.println();
                coup_fait = !coup_fait;   
            }

            catch (CoupInvalideException e) {
              System.out.println("Erreur ! Prise invalide : " + e.getNombreAllumettes() + "(>" + Math.min(jeu.getNombreAllumettes(), NouveauJeu.PRISE_MAX) + ")");
              System.out.println("Recommencez !");
            }
        } 
        if (coup_fait) {
            Joueur gagnant = this.joueur2;
            Joueur perdant = this.joueur1;
        }
        Joueur gagnant = this.joueur1;
        Joueur perdant = this.joueur2;
   
        System.out.println(perdant.getNom() + " a perdu !");
        System.out.println(gagnant.getNom() + " a gagné !");
    }

}