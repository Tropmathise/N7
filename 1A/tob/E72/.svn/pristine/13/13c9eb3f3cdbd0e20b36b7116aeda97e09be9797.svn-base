package monopoly.swing;

import javax.swing.DefaultListModel;
import javax.swing.ImageIcon;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.ListSelectionModel;

import monopoly.cases.CaseAchetable;
import monopoly.divers.Case;
import monopoly.divers.JoueurMonopoly;
import monopoly.divers.Partie;
import monopoly.divers.Plateau;
import monopoly.divers.StringPerso;

public class InfosJoueur extends JComponent {

    private static final long serialVersionUID = 1L;

    private JoueurMonopoly joueur;
    private JLabel solde = new JLabel();
    private CaseSwing position;
    private JLabel nbTourDePlateau = new JLabel();
    private JLabel nbTourEnPrison = new JLabel();
    private JList<String> proprietes = new JList<String>();
    private JLabel estEnPrison = initImage("res/Est_En_Prison.png");
    private JLabel carteSortiePrison = initImage("res/Sortie_Prison.png");

    public InfosJoueur(JoueurMonopoly joueur) {
        super();
        this.joueur = joueur;
        System.out.println(joueur.getNom());
        actualiserInfos();
        initFormats();
    }

    public void actualiserInfos() {
        this.solde.setText("Solde : " + this.joueur.getSolde());
        this.position = null;
        this.position = new CaseSwing(this.joueur.getPosition());
        this.nbTourDePlateau.setText("Tours de plateau : " + this.joueur.getNbToursPlateau());
        this.nbTourEnPrison.setText("Tours en prison : " + this.joueur.getToursEnPrison());
        DefaultListModel<String> liste = new DefaultListModel<String>();
        for (int i = 0; i < Plateau.nbCases; i++) {
            Case c = Plateau.cases[i];
            if (c instanceof CaseAchetable) {
                try {
                    if (((CaseAchetable) c).getProp().equals(this.joueur)) {
                        liste.addElement(c.getNom());
                    }
                }
                catch (NullPointerException e) {}
            }
        }
        this.proprietes.removeAll();
        this.proprietes = new JList<String>(liste);
        liste.removeAllElements();
        this.carteSortiePrison.setVisible(this.joueur.getCarteSortieDePrison());
        this.estEnPrison.setVisible(this.joueur.getEstEnPrison());
    }

    private void initFormats() {
        this.solde.setBounds(10, 10, 400, 25);
        this.nbTourDePlateau.setBounds(10, 40, 300, 25);
        this.nbTourEnPrison.setBounds(10, 70, 300, 25);
        this.position.setBounds(310, 60, 40, 40);
        this.proprietes.setBounds(10, 100, 400, 200);
        this.estEnPrison.setBounds(10, 310, 40, 40);
        this.carteSortiePrison.setBounds(60, 310, 40, 40);

        this.solde.setVisible(true);
        this.nbTourDePlateau.setVisible(true);
        this.nbTourEnPrison.setVisible(true);
        this.position.setVisible(true);

        this.proprietes.setVisible(true);
        this.proprietes.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        this.proprietes.setLayoutOrientation(JList.VERTICAL);

        this.add(this.solde);
        this.add(this.nbTourDePlateau);
        this.add(this.nbTourEnPrison);
        this.add(this.position);
        this.add(this.proprietes);
        this.add(this.estEnPrison);
        this.add(this.carteSortiePrison);
    }

    private JLabel initImage(String chemin) {

        ImageIcon image = new ImageIcon();
        java.net.URL imageURL = Partie.class.getResource(chemin);

        if (imageURL != null) {
            image = null;
            image = new ImageIcon(imageURL);
        }
        else {
            System.out.println(StringPerso.creer("L'image " + chemin + " n'a pas été trouvée."));
        }
        return new JLabel(image);
    }

}